<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fuchsia Mod Development Reference: ImagePipe Interface Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fuchsia Mod Development Reference
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Groups</span></a></li>
      <li class="current"><a href="annotated.html"><span>Interfaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Interface&#160;List</span></a></li>
      <li><a href="classes.html"><span>Interface&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Interface&#160;members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('interface_image_pipe.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="interface_image_pipe-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ImagePipe Interface Reference<div class="ingroups"><a class="el" href="group__scenic.html">Scenic</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9f066dd10cd40a1ad52ca014d090c0a6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interface_image_pipe.html#a9f066dd10cd40a1ad52ca014d090c0a6">AddImage</a> (uint32 image_id, <a class="el" href="struct_image_info.html">ImageInfo</a> image_info, handle&lt; vmo &gt; memory, <a class="el" href="group__scenic.html#ga462bfa9dfea81692463ecb192183dd01">MemoryType</a> memory_type, uint64 memory_offset)</td></tr>
<tr class="separator:a9f066dd10cd40a1ad52ca014d090c0a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e60e9db4cf3c8f8016082f46a697cba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interface_image_pipe.html#a2e60e9db4cf3c8f8016082f46a697cba">RemoveImage</a> (uint32 image_id)</td></tr>
<tr class="separator:a2e60e9db4cf3c8f8016082f46a697cba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0f2d6a8a2174b2ddb86509041b5bc63"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interface_image_pipe.html#ae0f2d6a8a2174b2ddb86509041b5bc63">PresentImage</a> (uint32 image_id, uint64 presentation_time, handle&lt; event &gt;?acquire_fence, handle&lt; event &gt;?release_fence)</td></tr>
<tr class="separator:ae0f2d6a8a2174b2ddb86509041b5bc63"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="interface_image_pipe.html">ImagePipe</a> is a mechanism for streaming shared images between a producer and a consumer which may be running in different processes.</p>
<p>Conceptually, the image pipe maintains a table of image resources supplied by the producer into which graphical content may be stored as well as a presentation queue containing a sequence of images which the producer has asked the consumer to present.</p>
<p>The presentation queue is initially empty.</p>
<p>Each entry in the presentation queue consists of an image together with a pair of optional synchronization fences:</p>
<ul>
<li>Acquire fence: signaled by the producer when the image is ready to be consumed</li>
<li>Release fence: signaled by the consumer when the image is free to be freed or modified by the producer</li>
</ul>
<p>The producer performs the following sequence of steps to present content:</p>
<ul>
<li>Allocate and add some number of images (often 2 or 3) to the image pipe to establish a pool using |AddImage()|.</li>
<li>Obtain the next available image from the pool.</li>
<li>Ask the consumer to enqueue an image for presentation and provide fences using |PresentImage()|.</li>
<li>Start rendering the image.</li>
<li>Signal the image's acquire fence when rendering is complete.</li>
<li>Loop to present more image, listen for signals on release fences to recycle images back into the pool.</li>
</ul>
<p>The consumer performs the following sequence of steps for each image which is enqueued in the presentation queue:</p>
<ul>
<li>Await signals on the image's acquire fence.</li>
<li>If the fence wait cannot be satisfied or if some other error is detected, close the image pipe. Otherwise, begin presenting the image's content.</li>
<li>Retire the previously presented image (if any) from the presentation queue and signal its release fence when no longer needed.</li>
<li>Continue presenting the same image until the next one is ready. Loop.</li>
</ul>
<p>If the producer wants to close the image pipe, it should:</p>
<ul>
<li>Close its side of the connection.</li>
<li>Wait on all release fences for buffers that it has submitted with |PresentImage()|.</li>
<li>Proceed with resource cleanup.</li>
</ul>
<p>When the consumer detects the image pipe has closed, it should:</p>
<ul>
<li>Stop using/presenting any images from the pipe.</li>
<li>Unmap all VMOs associated with the images in the pipe.</li>
<li>Close all handles to the VMOs.</li>
<li>Signal all release fences for presented and queued buffers.</li>
<li>Close all handles to fences.</li>
<li>Close its side of the connection.</li>
</ul>
<p>When either party detects that a fence has been abandoned (remotely closed without being signaled) it should assume that the associated image is in an indeterminate state. This will typically happen when the other party (or one of its delegates) has crashed. The safest course of action is to close the image pipe, release all resources which were shared with the other party, and re-establish the connection to recover. </p>

<p>Definition at line <a class="el" href="image__pipe_8fidl_source.html#l00069">69</a> of file <a class="el" href="image__pipe_8fidl_source.html">image_pipe.fidl</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a9f066dd10cd40a1ad52ca014d090c0a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ImagePipe::AddImage </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>image_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_image_info.html">ImageInfo</a>&#160;</td>
          <td class="paramname"><em>image_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">handle&lt; vmo &gt;&#160;</td>
          <td class="paramname"><em>memory</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__scenic.html#ga462bfa9dfea81692463ecb192183dd01">MemoryType</a>&#160;</td>
          <td class="paramname"><em>memory_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64&#160;</td>
          <td class="paramname"><em>memory_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adds an image resource to image pipe.</p>
<p>The |memory| is the handle of a memory object which contains the image data. It is valid to create multiple images backed by the same memory object; they may even overlap. Consumers must detect this and handle it accordingly. The type of memory stored in the VMO is |memory_type| (e.g. GPU memory, host memory). The |memory_offset| indicates the offset within the memory object at which the image data begins.</p>
<p>The following errors will cause the connection to be closed:</p>
<ul>
<li>|image_id| is already registered</li>
<li>|image_info| represents a format not supported by the consumer</li>
<li>|memory| is not a handle for a readable VMO</li>
<li>the image data expected at |memory_offset| according to the |image_info| exceeds the memory object's bounds </li>
</ul>

</div>
</div>
<a class="anchor" id="ae0f2d6a8a2174b2ddb86509041b5bc63"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ImagePipe::PresentImage </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>image_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64&#160;</td>
          <td class="paramname"><em>presentation_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">handle&lt; event &gt;?&#160;</td>
          <td class="paramname"><em>acquire_fence</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">handle&lt; event &gt;?&#160;</td>
          <td class="paramname"><em>release_fence</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enqueues the specified image for presentation.</p>
<p>The |acquire_fence|, if not null, specifies a fence which the consumer must await before presenting the image. The |release_fence|, if not null, specifies a fence which the consumer must signal when it is safe for the producer to free or modify the image. |presentation_time| specifies the time on or after which the client would like the enqueued operations should take visible effect (light up pixels on the screen), expressed in nanoseconds in the |CLOCK_MONOTONIC| timebase. Desired presentation times must be monotonically non-decreasing.</p>
<p>|presentation_info| returns timing information about the submitted frame and future frames (see <a class="el" href="presentation__info_8fidl_source.html">presentation_info.fidl</a>).</p>
<p>The following errors will cause the connection to be closed:</p>
<ul>
<li>|image_id| does not reference a currently registered image resource </li>
</ul>

</div>
</div>
<a class="anchor" id="a2e60e9db4cf3c8f8016082f46a697cba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ImagePipe::RemoveImage </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>image_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Removes an image resource from the pipe.</p>
<p>The |image_id| is detached from the image resource and is free to be reused to add a new image resource.</p>
<p>Removing an image from the image pipe does not affect the presentation queue or the currently presented image.</p>
<p>The producer must wait for all release fences associated with the image to be signaled before freeing or modifying the underlying memory object since the image may still be in use in the presentation queue.</p>
<p>The following errors will cause the connection to be closed:</p>
<ul>
<li>|image_id| does not reference a currently registered image resource </li>
</ul>

</div>
</div>
<hr/>The documentation for this interface was generated from the following file:<ul>
<li>/usr/local/google/home/gregsimon/fuchsia/garnet/public/lib/images/fidl/<a class="el" href="image__pipe_8fidl_source.html">image_pipe.fidl</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="interface_image_pipe.html">ImagePipe</a></li>
    <li class="footer">Copyright 2017 The Fuchsia Project Authors.</li>
  </ul>
</div>
</body>
</html>
